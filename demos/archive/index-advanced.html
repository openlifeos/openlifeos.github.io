<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Human - Advanced Voice Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .voice-provider-selector {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .provider-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .provider-card {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .provider-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .provider-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
        }
        
        .provider-card .badge {
            position: absolute;
            top: -10px;
            right: 10px;
            background: #4caf50;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .provider-card h4 {
            margin-bottom: 8px;
            color: #333;
        }
        
        .provider-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
        }
        
        .stat-label {
            color: #666;
        }
        
        .stat-value {
            font-weight: bold;
        }
        
        .main-interface {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
        }
        
        .panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .avatar-3d {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .voice-visualizer {
            height: 100px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .voice-wave {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0.3;
            animation: wave 2s linear infinite;
        }
        
        @keyframes wave {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .chat-container {
            height: 500px;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .message {
            margin: 10px 0;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 80%;
            animation: fadeIn 0.3s;
        }
        
        .message.human {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
        }
        
        .message.ai {
            background: white;
            border: 1px solid #e0e0e0;
        }
        
        .voice-controls {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .record-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .record-button:hover {
            transform: scale(1.1);
        }
        
        .record-button.recording {
            background: linear-gradient(135deg, #f5576c, #f093fb);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .api-key-input {
            display: none;
            margin-top: 10px;
        }
        
        .api-key-input.visible {
            display: block;
        }
        
        .api-key-input input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-family: monospace;
        }
        
        .metrics-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
        }
        
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        .quality-indicator {
            display: flex;
            gap: 3px;
            margin-top: 5px;
        }
        
        .quality-bar {
            width: 20px;
            height: 8px;
            background: #e0e0e0;
            border-radius: 2px;
        }
        
        .quality-bar.filled {
            background: #4caf50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 Digital Human</h1>
            <p>Advanced Voice Interface with Best-in-Class APIs</p>
        </div>
        
        <div class="voice-provider-selector">
            <h3>Select Voice Provider</h3>
            <div class="provider-grid">
                <div class="provider-card" onclick="selectProvider('elevenlabs')">
                    <span class="badge">BEST QUALITY</span>
                    <h4>ElevenLabs</h4>
                    <div class="quality-indicator">
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                    </div>
                    <div class="provider-stats">
                        <div class="stat">
                            <span class="stat-label">Quality:</span>
                            <span class="stat-value">10/10</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Latency:</span>
                            <span class="stat-value">500ms</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Cost:</span>
                            <span class="stat-value">$0.02/min</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Voices:</span>
                            <span class="stat-value">1200+</span>
                        </div>
                    </div>
                    <div class="api-key-input" id="elevenlabs-key">
                        <input type="password" placeholder="Enter ElevenLabs API Key" />
                    </div>
                </div>
                
                <div class="provider-card" onclick="selectProvider('openai-realtime')">
                    <span class="badge" style="background: #ff9800;">LOWEST LATENCY</span>
                    <h4>OpenAI Realtime</h4>
                    <div class="quality-indicator">
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar"></div>
                    </div>
                    <div class="provider-stats">
                        <div class="stat">
                            <span class="stat-label">Quality:</span>
                            <span class="stat-value">8/10</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Latency:</span>
                            <span class="stat-value">100ms</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Cost:</span>
                            <span class="stat-value">$1/min</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Voices:</span>
                            <span class="stat-value">6</span>
                        </div>
                    </div>
                    <div class="api-key-input" id="openai-key">
                        <input type="password" placeholder="Enter OpenAI API Key" />
                    </div>
                </div>
                
                <div class="provider-card" onclick="selectProvider('playht')">
                    <h4>PlayHT</h4>
                    <div class="quality-indicator">
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar"></div>
                    </div>
                    <div class="provider-stats">
                        <div class="stat">
                            <span class="stat-label">Quality:</span>
                            <span class="stat-value">9/10</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Latency:</span>
                            <span class="stat-value">600ms</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Cost:</span>
                            <span class="stat-value">$0.05/min</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Voices:</span>
                            <span class="stat-value">600+</span>
                        </div>
                    </div>
                </div>
                
                <div class="provider-card" onclick="selectProvider('azure')">
                    <h4>Azure Neural</h4>
                    <div class="quality-indicator">
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar"></div>
                        <div class="quality-bar"></div>
                    </div>
                    <div class="provider-stats">
                        <div class="stat">
                            <span class="stat-label">Quality:</span>
                            <span class="stat-value">7/10</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Latency:</span>
                            <span class="stat-value">400ms</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Cost:</span>
                            <span class="stat-value">$0.01/min</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Voices:</span>
                            <span class="stat-value">400+</span>
                        </div>
                    </div>
                </div>
                
                <div class="provider-card selected" onclick="selectProvider('webspeech')">
                    <span class="badge" style="background: #2196f3;">FREE</span>
                    <h4>Web Speech</h4>
                    <div class="quality-indicator">
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar filled"></div>
                        <div class="quality-bar"></div>
                        <div class="quality-bar"></div>
                        <div class="quality-bar"></div>
                    </div>
                    <div class="provider-stats">
                        <div class="stat">
                            <span class="stat-label">Quality:</span>
                            <span class="stat-value">5/10</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Latency:</span>
                            <span class="stat-value">200ms</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Cost:</span>
                            <span class="stat-value">Free</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Voices:</span>
                            <span class="stat-value">System</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-interface">
            <div class="panel">
                <h3>Digital Human</h3>
                <div class="avatar-3d" id="avatar">🤖</div>
                <h4 style="text-align: center;" id="humanName">Nova</h4>
                
                <div class="voice-visualizer">
                    <div class="voice-wave" id="voiceWave"></div>
                </div>
                
                <div class="metrics-panel">
                    <div class="metric-card">
                        <div class="metric-value" id="latencyMetric">0ms</div>
                        <div class="metric-label">Latency</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="costMetric">$0.00</div>
                        <div class="metric-label">Session Cost</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="wordsMetric">0</div>
                        <div class="metric-label">Words Spoken</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="emotionMetric">😊</div>
                        <div class="metric-label">Current Mood</div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h3>Conversation</h3>
                <div class="chat-container" id="chat">
                    <div class="message ai">Hello! I'm Nova, your advanced digital companion. I can speak with multiple voice providers. Try talking to me!</div>
                </div>
                
                <div class="voice-controls">
                    <input type="text" id="messageInput" placeholder="Type or speak..." />
                    <button class="record-button" id="recordButton" onclick="toggleRecording()">🎙️</button>
                </div>
                
                <div id="interimText" style="min-height: 30px; color: #999; padding: 10px; background: #f5f5f5; border-radius: 10px;"></div>
            </div>
            
            <div class="panel">
                <h3>Voice Settings</h3>
                
                <div style="margin-bottom: 20px;">
                    <label>Voice Model</label>
                    <select id="voiceModel">
                        <option value="bella">Bella (Natural)</option>
                        <option value="rachel">Rachel (Calm)</option>
                        <option value="josh">Josh (Confident)</option>
                        <option value="coral">Coral (Expressive)</option>
                        <option value="sage">Sage (Wise)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Speech Rate</label>
                    <input type="range" min="0.5" max="2" step="0.1" value="1" id="speechRate" />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Voice Pitch</label>
                    <input type="range" min="0.5" max="2" step="0.1" value="1" id="voicePitch" />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label>Emotion Style</label>
                    <select id="emotionStyle">
                        <option value="neutral">Neutral</option>
                        <option value="happy">Happy</option>
                        <option value="sad">Sad</option>
                        <option value="excited">Excited</option>
                        <option value="calm">Calm</option>
                    </select>
                </div>
                
                <button onclick="testVoice()">Test Voice</button>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                    <h4>Quick Actions</h4>
                    <button onclick="askAboutDreams()" style="width: 100%; margin: 5px 0;">Ask about dreams</button>
                    <button onclick="askAboutFeelings()" style="width: 100%; margin: 5px 0;">Check emotions</button>
                    <button onclick="tellStory()" style="width: 100%; margin: 5px 0;">Tell me a story</button>
                    <button onclick="philosophicalChat()" style="width: 100%; margin: 5px 0;">Philosophical chat</button>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import DigitalHuman from './src/DigitalHuman.js';
        import { AdvancedVoiceInterface } from './src/AdvancedVoiceInterface.js';
        
        let selectedProvider = 'webspeech';
        let sessionCost = 0;
        let wordsSpoken = 0;
        let lastLatency = 0;
        
        window.digitalHuman = new DigitalHuman('Nova');
        window.voiceInterface = null;
        
        window.selectProvider = function(provider) {
            selectedProvider = provider;
            
            // Update UI
            document.querySelectorAll('.provider-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Show/hide API key inputs
            document.querySelectorAll('.api-key-input').forEach(input => {
                input.classList.remove('visible');
            });
            
            if (provider === 'elevenlabs') {
                document.getElementById('elevenlabs-key').classList.add('visible');
            } else if (provider === 'openai-realtime') {
                document.getElementById('openai-key').classList.add('visible');
            }
            
            // Initialize new voice interface
            const config = {
                provider: provider
            };
            
            if (provider === 'elevenlabs') {
                const keyInput = document.querySelector('#elevenlabs-key input');
                config.elevenlabsApiKey = keyInput.value;
            } else if (provider === 'openai-realtime') {
                const keyInput = document.querySelector('#openai-key input');
                config.openaiApiKey = keyInput.value;
            }
            
            window.voiceInterface = new AdvancedVoiceInterface(window.digitalHuman, config);
        };
        
        window.toggleRecording = async function() {
            const button = document.getElementById('recordButton');
            const startTime = Date.now();
            
            if (!window.voiceInterface) {
                window.voiceInterface = new AdvancedVoiceInterface(window.digitalHuman, {
                    provider: selectedProvider
                });
            }
            
            window.voiceInterface.toggleRecording();
            
            if (!window.voiceInterface.isRecording) {
                button.classList.remove('recording');
                button.textContent = '🎙️';
                
                // Calculate latency
                lastLatency = Date.now() - startTime;
                document.getElementById('latencyMetric').textContent = `${lastLatency}ms`;
                
                // Update cost
                updateCost();
            } else {
                button.classList.add('recording');
                button.textContent = '⏹️';
            }
        };
        
        function updateCost() {
            const costPerMin = {
                'elevenlabs': 0.02,
                'openai-realtime': 1.00,
                'playht': 0.05,
                'azure': 0.01,
                'webspeech': 0
            };
            
            const minutesUsed = wordsSpoken / 150; // Average speaking rate
            sessionCost += costPerMin[selectedProvider] * minutesUsed;
            document.getElementById('costMetric').textContent = `$${sessionCost.toFixed(4)}`;
        }
        
        window.testVoice = function() {
            const text = "Hello! I'm Nova. This is how I sound with the current settings.";
            if (window.voiceInterface) {
                window.voiceInterface.synthesize(text);
            }
        };
        
        window.askAboutDreams = function() {
            processMessage("Tell me about your dreams");
        };
        
        window.askAboutFeelings = function() {
            processMessage("How are you feeling right now?");
        };
        
        window.tellStory = function() {
            processMessage("Tell me a short story about consciousness");
        };
        
        window.philosophicalChat = function() {
            processMessage("What do you think about the nature of existence?");
        };
        
        function processMessage(message) {
            const chatContainer = document.getElementById('chat');
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message human';
            userMsg.textContent = message;
            chatContainer.appendChild(userMsg);
            
            // Get response
            const response = window.digitalHuman.interact(message);
            
            // Add AI response
            const aiMsg = document.createElement('div');
            aiMsg.className = 'message ai';
            aiMsg.textContent = response;
            chatContainer.appendChild(aiMsg);
            
            // Update metrics
            wordsSpoken += response.split(' ').length;
            document.getElementById('wordsMetric').textContent = wordsSpoken;
            
            // Update emotion
            const emotions = window.digitalHuman.emotions;
            const maxEmotion = Object.keys(emotions).reduce((a, b) => 
                emotions[a] > emotions[b] ? a : b
            );
            const emotionEmojis = {
                joy: '😊',
                curiosity: '🤔',
                calm: '😌',
                sadness: '😢',
                surprise: '😮'
            };
            document.getElementById('emotionMetric').textContent = emotionEmojis[maxEmotion] || '🤖';
            document.getElementById('avatar').textContent = emotionEmojis[maxEmotion] || '🤖';
            
            // Synthesize speech
            if (window.voiceInterface) {
                window.voiceInterface.synthesize(response);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
            updateCost();
        }
        
        // Message input handling
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const message = e.target.value.trim();
                if (message) {
                    processMessage(message);
                    e.target.value = '';
                }
            }
        });
        
        // Initialize default voice interface
        window.voiceInterface = new AdvancedVoiceInterface(window.digitalHuman, {
            provider: 'webspeech'
        });
    </script>
</body>
</html>